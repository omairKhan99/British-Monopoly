<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monopoly - British Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #cce2d4;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Align board to top */
            min-height: 100vh;
            padding: 20px;
            margin: 0;
            overflow-x: hidden;
        }

        .game-container {
            display: flex;
            flex-direction: column; /* Stack board and controls */
            align-items: center;
            gap: 20px;
        }

        .board {
            display: grid;
            grid-template-columns: 100px repeat(9, 65px) 100px;
            grid-template-rows: 100px repeat(9, 65px) 100px;
            gap: 2px;
            border: 3px solid black;
            background-color: #f7f7f7;
            width: 802px;
            height: 802px;
            position: relative;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .space {
            background-color: #f7f7f7;
            border: 1px solid #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between; /* Distribute space for token container */
            text-align: center;
            font-size: 9px;
            line-height: 1.2;
            position: relative;
            padding: 1px;
            box-sizing: border-box;
            overflow: hidden;
        }
        .space .content { /* Wraps the original content */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 70%; 
            height: 70%;
            width: 100%
        }
        .space .token-container {
            width: 100%;
            height: 30%; /* Space for tokens */
            display: flex;
            flex-wrap: wrap; /* Allow tokens to wrap if many */
            align-items: center;
            justify-content: center;
            gap: 2px;
            padding: 1px;
        }
        .player-token {
            width: 22px;  /* Adjusted for emoji size */
            height: 22px; /* Adjusted for emoji size */
            font-size: 18px; /* Emoji size */
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(0,0,0,0.2); /* Lighter border */
            border-radius: 4px; /* Slightly rounded square */
            box-shadow: 0 1px 2px rgba(0,0,0,0.3);
            line-height: 1;
        }
        .owner-marker-container {
            height: 5%; /* Space for owner marker */
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-end; /* Place marker at the bottom of its container */
        }
        .owner-marker {
            width: 80%;
            height: 5px; /* Height of the color strip */
            border-top: 1px solid black; /* Optional: border for the marker */
        }

        .corner {
            font-weight: bold;
            font-size: 14px;
        }
        .corner .content { height: 80%; } 
        .corner .token-container { height: 20%; }


        .property .color-bar {
            height: 15px;
            width: 100%;
            border-bottom: 1px solid #333;
            margin-bottom: 1px;
        }
        .property .name {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1px 0;
            font-weight: 500;
            width: 100%;
        }
        .property .price {
            font-weight: 600;
            margin-top: 1px;
        }

        /* Property specific styles */
        .row-1 { grid-row: 1; }
        .row-11 { grid-row: 11; }
        .col-1 { grid-column: 1; }
        .col-11 { grid-column: 11; }

        /* Bottom Row */
        .space-go { grid-column: 11; grid-row: 11; }
        .space-old-kent-road { grid-column: 10; grid-row: 11; }
        .space-community-chest-bottom { grid-column: 9; grid-row: 11; }
        .space-whitechapel-road { grid-column: 8; grid-row: 11; }
        .space-income-tax { grid-column: 7; grid-row: 11; }
        .space-kings-cross { grid-column: 6; grid-row: 11; }
        .space-the-angel-islington { grid-column: 5; grid-row: 11; }
        .space-chance-bottom { grid-column: 4; grid-row: 11; }
        .space-euston-road { grid-column: 3; grid-row: 11; }
        .space-pentonville-road { grid-column: 2; grid-row: 11; }
        .space-jail { grid-column: 1; grid-row: 11; }

        /* Left Column */
        .space-pall-mall { grid-column: 1; grid-row: 10; }
        .space-electric-company { grid-column: 1; grid-row: 9; }
        .space-whitehall { grid-column: 1; grid-row: 8; }
        .space-northumberland-avenue { grid-column: 1; grid-row: 7; }
        .space-marylebone-station { grid-column: 1; grid-row: 6; }
        .space-bow-street { grid-column: 1; grid-row: 5; }
        .space-community-chest-left { grid-column: 1; grid-row: 4; }
        .space-marlborough-street { grid-column: 1; grid-row: 3; }
        .space-vine-street { grid-column: 1; grid-row: 2; }
        .space-free-parking { grid-column: 1; grid-row: 1; }

        /* Top Row */
        .space-strand { grid-column: 2; grid-row: 1; }
        .space-chance-top { grid-column: 3; grid-row: 1; }
        .space-fleet-street { grid-column: 4; grid-row: 1; }
        .space-trafalgar-square { grid-column: 5; grid-row: 1; }
        .space-fenchurch-st-station { grid-column: 6; grid-row: 1; }
        .space-leicester-square { grid-column: 7; grid-row: 1; }
        .space-coventry-street { grid-column: 8; grid-row: 1; }
        .space-water-works { grid-column: 9; grid-row: 1; }
        .space-piccadilly { grid-column: 10; grid-row: 1; }
        .space-go-to-jail { grid-column: 11; grid-row: 1; }

        /* Right Column */
        .space-regent-street { grid-column: 11; grid-row: 2; }
        .space-oxford-street { grid-column: 11; grid-row: 3; }
        .space-community-chest-right { grid-column: 11; grid-row: 4; }
        .space-bond-street { grid-column: 11; grid-row: 5; }
        .space-liverpool-st-station { grid-column: 11; grid-row: 6; }
        .space-chance-right { grid-column: 11; grid-row: 7; }
        .space-park-lane { grid-column: 11; grid-row: 8; }
        .space-super-tax { grid-column: 11; grid-row: 9; }
        .space-mayfair { grid-column: 11; grid-row: 10; }

        .left-col .content .name, .right-col .content .name,
        .left-col .content .price, .right-col .content .price,
        .left-col.space .content > div:not(.color-bar):not(.name):not(.price),
        .right-col.space .content > div:not(.color-bar):not(.name):not(.price) {
            font-size: 7.5px;
            line-height: 1.1;
        }
        
        .left-col .content .name, .right-col .content .name {
            text-align: center;
            white-space: normal;
            width: 22px;
            margin: 1px 0;
        }

        .left-col.property .content .name, .left-col.space .content .station-icon + div, .left-col.space .content .utility-icon + div, .left-col.space .content .tax-icon + div, .left-col.space .content .chance-icon + div, .left-col.space .content .community-chest-icon + div {
            transform: rotate(90deg);
        }
        .right-col.property .content .name, .right-col.space .content .station-icon + div, .right-col.space .content .utility-icon + div, .right-col.space .content .tax-icon + div, .right-col.space .content .chance-icon + div, .right-col.space .content .community-chest-icon + div {
            transform: rotate(-90deg);
        }
         .left-col .content .price, .right-col .content .price {
            transform: none !important;
         }

        .top-row.property .content .name, .top-row.space .content .station-icon + div, .top-row.space .content .utility-icon + div {
             transform: rotate(180deg);
        }
         .top-row .content .price {
            transform: rotate(180deg);
         }

        .space-jail .just { position: absolute; top: 15px; left: 5px; transform: rotate(45deg); font-size: 10px;}
        .space-jail .visiting { position: absolute; bottom: 15px; right: 5px; transform: rotate(45deg); font-size: 10px;}
        .space-go .arrow { font-size: 30px; color: #d60000; line-height: 1; }

        .center-area {
            grid-column: 2 / span 9;
            grid-row: 2 / span 9;
            background-color: #ddebe0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-around;
            border: 2px solid black;
            padding: 20px;
        }
        .game-title {
            font-size: 48px;
            font-weight: bold;
            color: #d60000;
            text-shadow: 2px 2px #000;
            letter-spacing: 2px;
        }
        .card-pile-placeholder {
            width: 150px;
            height: 100px;
            border: 2px dashed #555;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            border-radius: 8px;
            background-color: #f0f0f0;
            font-weight: 500;
        }
        .card-piles-container {
            display: flex;
            justify-content: space-around;
            width: 100%;
        }

        .brown { background-color: #955436; }
        .light-blue { background-color: #aae0fa; }
        .pink { background-color: #d93a96; }
        .orange { background-color: #f7941d; }
        .red { background-color: #ed1b24; }
        .yellow { background-color: #fff200; }
        .green { background-color: #1fb25a; }
        .dark-blue { background-color: #0072bb; }

        .station-icon, .utility-icon, .tax-icon, .chance-icon, .community-chest-icon {
            font-size: 20px;
            margin-bottom: 3px;
        }
        .station-icon::before { content: "üöÇ"; }
        .utility-icon.electric::before { content: "üí°"; }
        .utility-icon.water::before { content: "üíß"; }
        .tax-icon.income::before { content: "üí∏"; }
        .tax-icon.super::before { content: "üíé"; }
        .chance-icon::before { content: "‚ùì"; }
        .community-chest-icon::before { content: "üéÅ"; }

        /* Game Controls & Player Info Area */
        .game-controls {
            background-color: #f0e6d2; /* Creamy background */
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            width: 100%;
            max-width: 800px; /* Match board width */
            margin-top: 20px;
            text-align: center;
        }
        .player-info-container {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .player-info {
            background-color: #fff;
            border: 2px solid #ccc;
            padding: 10px 15px;
            border-radius: 8px;
            min-width: 150px;
            text-align: left;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
        }
        .player-info.active-player {
            border-color: #d60000; /* Highlight active player */
            box-shadow: 0 0 10px #d60000;
        }
        .player-info h3 {
            margin-top: 0;
            font-size: 1.1em;
            font-weight: 600;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            margin-bottom: 8px;
        }
        .dice-area {
            margin: 15px 0;
        }
        .dice-area span {
            display: inline-block;
            width: 40px;
            height: 40px;
            line-height: 40px;
            text-align: center;
            border: 1px solid #333;
            background-color: white;
            font-size: 20px;
            font-weight: bold;
            margin: 0 5px;
            border-radius: 5px;
        }
        #rollDiceButton {
            background-color: #4CAF50; /* Green */
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #rollDiceButton:hover {
            background-color: #45a049;
        }
        #rollDiceButton:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .message-log {
            margin-top: 15px;
            padding: 10px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            min-height: 50px;
            text-align: left;
            font-size: 0.9em;
        }

    </style>
</head>
<body>
    <div class="game-container">
        <div class="board">
            <div id="space-30" class="space corner space-go-to-jail">
                <div class="content">
                    <div>GO TO</div>
                    <div style="font-size: 30px;">üöì</div>
                    <div>JAIL</div>
                </div>
                <div class="token-container"></div>
            </div>

            <div id="space-21" class="space property top-row space-strand">
                <div class="content">
                    <div class="color-bar red"></div>
                    <div class="name">STRAND</div>
                    <div class="price">¬£220</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-22" class="space top-row space-chance-top">
                <div class="content">
                    <div class="chance-icon"></div>
                    <div>CHANCE</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-23" class="space property top-row space-fleet-street">
                <div class="content">
                    <div class="color-bar red"></div>
                    <div class="name">FLEET STREET</div>
                    <div class="price">¬£220</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-24" class="space property top-row space-trafalgar-square">
                <div class="content">
                    <div class="color-bar red"></div>
                    <div class="name">TRAFALGAR SQUARE</div>
                    <div class="price">¬£240</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-25" class="space top-row space-fenchurch-st-station">
                <div class="content">
                    <div class="station-icon"></div>
                    <div>FENCHURCH ST.<br>STATION</div>
                    <div class="price">¬£200</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-26" class="space property top-row space-leicester-square">
                <div class="content">
                    <div class="color-bar yellow"></div>
                    <div class="name">LEICESTER SQUARE</div>
                    <div class="price">¬£260</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-27" class="space property top-row space-coventry-street">
                <div class="content">
                    <div class="color-bar yellow"></div>
                    <div class="name">COVENTRY STREET</div>
                    <div class="price">¬£260</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-28" class="space top-row space-water-works">
                <div class="content">
                    <div class="utility-icon water"></div>
                    <div>WATER WORKS</div>
                    <div class="price">¬£150</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-29" class="space property top-row space-piccadilly">
                <div class="content">
                    <div class="color-bar yellow"></div>
                    <div class="name">PICCADILLY</div>
                    <div class="price">¬£280</div>
                </div>
                <div class="token-container"></div>
            </div>

            <div id="space-20" class="space corner space-free-parking">
                <div class="content">
                    <div>FREE</div>
                    <div style="font-size: 30px;">üÖøÔ∏è</div>
                    <div>PARKING</div>
                </div>
                <div class="token-container"></div>
            </div>

            <div id="space-19" class="space property left-col space-vine-street">
                <div class="content">
                    <div class="color-bar orange"></div>
                    <div class="name">VINE STREET</div>
                    <div class="price">¬£200</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-18" class="space property left-col space-marlborough-street">
                <div class="content">
                    <div class="color-bar orange"></div>
                    <div class="name">MARLBOROUGH STREET</div>
                    <div class="price">¬£180</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-17" class="space left-col space-community-chest-left">
                <div class="content">
                    <div class="community-chest-icon"></div>
                    <div>COMMUNITY CHEST</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-16" class="space property left-col space-bow-street">
                <div class="content">
                    <div class="color-bar orange"></div>
                    <div class="name">BOW STREET</div>
                    <div class="price">¬£180</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-15" class="space left-col space-marylebone-station">
                <div class="content">
                    <div class="station-icon"></div>
                    <div>MARYLEBONE STATION</div>
                    <div class="price">¬£200</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-14" class="space property left-col space-northumberland-avenue">
                <div class="content">
                    <div class="color-bar pink"></div>
                    <div class="name">NORTHUMBERLAND<br>AVENUE</div>
                    <div class="price">¬£160</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-13" class="space property left-col space-whitehall">
                <div class="content">
                    <div class="color-bar pink"></div>
                    <div class="name">WHITEHALL</div>
                    <div class="price">¬£140</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-12" class="space left-col space-electric-company">
                <div class="content">
                    <div class="utility-icon electric"></div>
                    <div>ELECTRIC COMPANY</div>
                    <div class="price">¬£150</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-11" class="space property left-col space-pall-mall">
                <div class="content">
                    <div class="color-bar pink"></div>
                    <div class="name">PALL MALL</div>
                    <div class="price">¬£140</div>
                </div>
                <div class="token-container"></div>
            </div>

            <div id="space-10" class="space corner space-jail">
                <div class="content">
                    <div class="just">JUST</div>
                    <div style="font-size:30px; border: 3px solid black; padding:10px; margin-top:10px; margin-bottom:10px; width: 60%; height: 60%; display:flex; align-items:center; justify-content:center;">üëÆ</div>
                    <div class="visiting">VISITING</div>
                </div>
                <div class="token-container"></div>
            </div>

            <div id="space-9" class="space property space-pentonville-road">
                <div class="content">
                    <div class="color-bar light-blue"></div>
                    <div class="name">PENTONVILLE ROAD</div>
                    <div class="price">¬£120</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-8" class="space property space-euston-road">
                <div class="content">
                    <div class="color-bar light-blue"></div>
                    <div class="name">EUSTON ROAD</div>
                    <div class="price">¬£100</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-7" class="space space-chance-bottom">
                <div class="content">
                    <div class="chance-icon"></div>
                    <div>CHANCE</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-6" class="space property space-the-angel-islington">
                <div class="content">
                    <div class="color-bar light-blue"></div>
                    <div class="name">THE ANGEL,<br>ISLINGTON</div>
                    <div class="price">¬£100</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-5" class="space space-kings-cross">
                <div class="content">
                    <div class="station-icon"></div>
                    <div>KING'S CROSS STATION</div>
                    <div class="price">¬£200</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-4" class="space space-income-tax">
                <div class="content">
                    <div class="tax-icon income"></div>
                    <div>INCOME TAX</div>
                    <div>PAY ¬£200</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-3" class="space property space-whitechapel-road">
                <div class="content">
                    <div class="color-bar brown"></div>
                    <div class="name">WHITECHAPEL ROAD</div>
                    <div class="price">¬£60</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-2" class="space space-community-chest-bottom">
                <div class="content">
                    <div class="community-chest-icon"></div>
                    <div>COMMUNITY CHEST</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-1" class="space property space-old-kent-road">
                <div class="content">
                    <div class="color-bar brown"></div>
                    <div class="name">OLD KENT ROAD</div>
                    <div class="price">¬£60</div>
                </div>
                <div class="token-container"></div>
            </div>

            <div id="space-0" class="space corner space-go">
                <div class="content">
                    <div>COLLECT ¬£200 SALARY AS YOU PASS</div>
                    <div class="arrow">‚ûî</div>
                    <div>GO</div>
                </div>
                <div class="token-container"></div>
            </div>

            <div id="space-39" class="space property right-col space-mayfair">
                <div class="content">
                    <div class="color-bar dark-blue"></div>
                    <div class="name">MAYFAIR</div>
                    <div class="price">¬£400</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-38" class="space right-col space-super-tax">
                <div class="content">
                    <div class="tax-icon super"></div>
                    <div>SUPER TAX</div>
                    <div>PAY ¬£100</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-37" class="space property right-col space-park-lane">
                <div class="content">
                    <div class="color-bar dark-blue"></div>
                    <div class="name">PARK LANE</div>
                    <div class="price">¬£350</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-36" class="space right-col space-chance-right">
                <div class="content">
                    <div class="chance-icon"></div>
                    <div>CHANCE</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-35" class="space right-col space-liverpool-st-station">
                <div class="content">
                    <div class="station-icon"></div>
                    <div>LIVERPOOL ST.<br>STATION</div>
                    <div class="price">¬£200</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-34" class="space property right-col space-bond-street">
                <div class="content">
                    <div class="color-bar green"></div>
                    <div class="name">BOND STREET</div>
                    <div class="price">¬£320</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-33" class="space right-col space-community-chest-right">
                <div class="content">
                    <div class="community-chest-icon"></div>
                    <div>COMMUNITY CHEST</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-32" class="space property right-col space-oxford-street">
                <div class="content">
                    <div class="color-bar green"></div>
                    <div class="name">OXFORD STREET</div>
                    <div class="price">¬£300</div>
                </div>
                <div class="token-container"></div>
            </div>
            <div id="space-31" class="space property right-col space-regent-street">
                <div class="content">
                    <div class="color-bar green"></div>
                    <div class="name">REGENT STREET</div>
                    <div class="price">¬£300</div>
                </div>
                <div class="token-container"></div>
            </div>

            <div class="center-area">
                <div class="game-title">MONOPOLY</div>
                <div class="card-piles-container">
                    <div class="card-pile-placeholder">CHANCE CARDS</div>
                    <div class="card-pile-placeholder">COMMUNITY CHEST CARDS</div>
                </div>
            </div>
        </div>

        <div class="game-controls">
            <div id="playerInfoContainer" class="player-info-container">
                </div>
            <div class="current-player-turn mb-4">
                Current Turn: <strong id="currentPlayerName">Player 1</strong>
            </div>
            <div class="dice-area">
                Dice: <span id="dice1Display">-</span> <span id="dice2Display">-</span>
                Total: <strong id="diceTotalDisplay">-</strong>
            </div>
            <button id="rollDiceButton">Roll Dice</button>
            <div id="messageLog" class="message-log">Welcome to Monopoly! Player 1's turn.</div>
        </div>
    </div>

    <script>
        // --- Game Constants ---
        const TOTAL_SPACES = 40;
        const PASS_GO_SALARY = 200;
        const STARTING_MONEY = 1500;
        const MAX_PLAYERS = 6;
        // Player visual representations (emojis) and UI colors
        const PLAYER_REPRESENTATIONS = ['üêé', 'üêÜ', 'üêò', 'üêÖ', 'üêí', 'üêï']; // Horse, Leopard, Elephant, Tiger, Monkey, Dog
        const PLAYER_UI_COLORS = ['#FF0000', '#0000FF', '#00AA00', '#FF8C00', '#800080', '#D2691E']; // Red, Blue, Dark Green, Orange, Purple, Brown (for UI elements like name headers)


        // --- Game State Variables ---
        let players = [];
        let currentPlayerIndex = 0;
        let dice = [0, 0];
        let gameInitialized = false;

        // --- DOM Elements ---
        const rollDiceButton = document.getElementById('rollDiceButton');
        const dice1Display = document.getElementById('dice1Display');
        const dice2Display = document.getElementById('dice2Display');
        const diceTotalDisplay = document.getElementById('diceTotalDisplay');
        const currentPlayerNameDisplay = document.getElementById('currentPlayerName');
        const playerInfoContainer = document.getElementById('playerInfoContainer');
        const messageLog = document.getElementById('messageLog');

        // Board space IDs (same as before)
        const boardSpaceIds = [
            'space-0', 'space-1', 'space-2', 'space-3', 'space-4', 'space-5', 'space-6', 'space-7', 'space-8', 'space-9',
            'space-10', 'space-11', 'space-12', 'space-13', 'space-14', 'space-15', 'space-16', 'space-17', 'space-18', 'space-19',
            'space-20', 'space-21', 'space-22', 'space-23', 'space-24', 'space-25', 'space-26', 'space-27', 'space-28', 'space-29',
            'space-30', 'space-31', 'space-32', 'space-33', 'space-34', 'space-35', 'space-36', 'space-37', 'space-38', 'space-39'
        ];


        // --- Game Logic Functions ---

        /**
         * Initializes the game with a specified number of players.
         * @param {number} numPlayers - Number of players (2-6).
         */
        function initializeGame(numPlayers = 2) {
            if (gameInitialized) {
                logMessage("Game already initialized.");
                return;
            }
            players = [];
            currentPlayerIndex = 0;

            playerInfoContainer.innerHTML = '';
            document.querySelectorAll('.player-token').forEach(token => token.remove());

            for (let i = 0; i < numPlayers; i++) {
                const player = {
                    id: i,
                    name: `Player ${i + 1}`,
                    tokenRepresentation: PLAYER_REPRESENTATIONS[i % PLAYER_REPRESENTATIONS.length],
                    uiColor: PLAYER_UI_COLORS[i % PLAYER_UI_COLORS.length], // Color for UI elements
                    money: STARTING_MONEY,
                    currentPosition: 0,
                    properties: [],
                    inJail: false,
                    jailTurns: 0,
                    getOutOfJailFreeCards: 0,
                    tokenElement: null,
                    infoElement: null
                };
                players.push(player);
                createPlayerToken(player);
                createPlayerInfoDisplay(player);
            }
            updateAllPlayerInfoDisplays();
            updateCurrentPlayerDisplay();
            logMessage(`Monopoly game started with ${numPlayers} players. ${players[0].name}'s turn.`);
            gameInitialized = true;
            rollDiceButton.disabled = false;
        }

        /**
         * Creates a visual token (emoji) for a player and adds it to the board.
         * @param {object} player - The player object.
         */
        function createPlayerToken(player) {
            const token = document.createElement('div');
            token.classList.add('player-token');
            token.innerHTML = player.tokenRepresentation; // Set emoji as content
            token.setAttribute('title', player.name); // Tooltip for player name
            player.tokenElement = token;
            placeTokenOnBoard(player);
        }

        /**
         * Creates the UI element to display player's information.
         * Player name header will use player.uiColor.
         * @param {object} player - The player object.
         */
        function createPlayerInfoDisplay(player) {
            const infoDiv = document.createElement('div');
            infoDiv.classList.add('player-info');
            infoDiv.id = `player-info-${player.id}`;
            infoDiv.innerHTML = `
                <h3 style="color: ${player.uiColor};">${player.name} (${player.tokenRepresentation})</h3>
                <p>Money: <span class="money-display">¬£${player.money}</span></p>
                <p>Position: <span class="position-display">GO</span></p>
            `;
            player.infoElement = infoDiv;
            playerInfoContainer.appendChild(infoDiv);
        }

        /**
         * Updates the displayed information for a single player.
         * @param {object} player - The player object.
         */
        function updatePlayerInfoDisplay(player) {
            if (player.infoElement) {
                player.infoElement.querySelector('.money-display').textContent = `¬£${player.money}`;
                const spaceElement = document.getElementById(boardSpaceIds[player.currentPosition]);
                let spaceName = `Space ${player.currentPosition}`; // Default
                if (spaceElement) {
                    // Try to get a descriptive name from the space's content
                    const nameElement = spaceElement.querySelector('.content .name');
                    if (nameElement) {
                        spaceName = nameElement.textContent.trim();
                    } else {
                        // Fallback for non-property spaces like GO, Jail, Chance etc.
                        const mainTextElement = spaceElement.querySelector('.content > div:first-child');
                        if (mainTextElement) {
                           spaceName = mainTextElement.textContent.trim().split('\n')[0];
                        }
                    }
                }
                player.infoElement.querySelector('.position-display').textContent = spaceName.split('\n')[0];
            }
            // Highlight active player
            document.querySelectorAll('.player-info').forEach(el => el.classList.remove('active-player'));
            if (players[currentPlayerIndex] && players[currentPlayerIndex].infoElement) {
                players[currentPlayerIndex].infoElement.classList.add('active-player');
            }
        }

        /**
         * Updates information for all players.
         */
        function updateAllPlayerInfoDisplays() {
            players.forEach(p => updatePlayerInfoDisplay(p));
        }


        /**
         * Places or moves a player's token to their currentPosition on the board.
         * @param {object} player - The player object.
         */
        function placeTokenOnBoard(player) {
            const currentSpaceId = boardSpaceIds[player.currentPosition];
            const spaceElement = document.getElementById(currentSpaceId);
            if (spaceElement) {
                const tokenContainer = spaceElement.querySelector('.token-container');
                if (tokenContainer) {
                    if (player.tokenElement.parentNode) {
                        player.tokenElement.parentNode.removeChild(player.tokenElement);
                    }
                    tokenContainer.appendChild(player.tokenElement);
                } else {
                    console.error(`Token container not found for space ID: ${currentSpaceId}`);
                }
            } else {
                console.error(`Space element not found for ID: ${currentSpaceId}`);
            }
        }

        function updateOwnerMarker(spaceIndex) {
            const spaceData = boardData[spaceIndex];
            const spaceElement = document.getElementById(spaceData.id);
            if (spaceElement && (spaceData.type === 'property' || spaceData.type === 'station' || spaceData.type === 'utility')) {
                const ownerMarkerElement = spaceElement.querySelector('.owner-marker');
                if (ownerMarkerElement) {
                    if (spaceData.ownerId !== null && players[spaceData.ownerId]) {
                        ownerMarkerElement.style.backgroundColor = players[spaceData.ownerId].uiColor;
                    } else {
                        ownerMarkerElement.style.backgroundColor = 'transparent'; // Or some default for unowned
                    }
                }
            }
        }



        function rollDice() {
            dice[0] = Math.floor(Math.random() * 6) + 1;
            dice[1] = Math.floor(Math.random() * 6) + 1;
            dice1Display.textContent = dice[0];
            dice2Display.textContent = dice[1];
            diceTotalDisplay.textContent = dice[0] + dice[1];
            return dice;
        }

        /**
         * Moves the current player based on the dice roll.
         */
        function handlePlayerTurn() {
            if (!gameInitialized) {
                logMessage("Please initialize the game first.");
                return;
            }
            rollDiceButton.disabled = true;

            const currentPlayer = players[currentPlayerIndex];
            const diceResult = rollDice();
            const steps = diceResult[0] + diceResult[1];

            logMessage(`${currentPlayer.name} (${currentPlayer.tokenRepresentation}) rolled ${diceResult[0]} + ${diceResult[1]} = ${steps}.`);

            const oldPosition = currentPlayer.currentPosition;
            currentPlayer.currentPosition = (oldPosition + steps) % TOTAL_SPACES;

            if (currentPlayer.currentPosition < oldPosition && oldPosition + steps >= TOTAL_SPACES) {
                currentPlayer.money += PASS_GO_SALARY;
                logMessage(`${currentPlayer.name} passed GO and collected ¬£${PASS_GO_SALARY}.`);
                updatePlayerInfoDisplay(currentPlayer);
            }

            placeTokenOnBoard(currentPlayer);
            updatePlayerInfoDisplay(currentPlayer); // Update money and position display

            const spaceElement = document.getElementById(boardSpaceIds[currentPlayer.currentPosition]);
            let newSpaceName = `Space ${currentPlayer.currentPosition}`;
            if (spaceElement) {
                const nameElement = spaceElement.querySelector('.content .name');
                 if (nameElement) {
                    newSpaceName = nameElement.textContent.trim();
                } else {
                    const mainTextElement = spaceElement.querySelector('.content > div:first-child');
                    if (mainTextElement) {
                       newSpaceName = mainTextElement.textContent.trim().split('\n')[0];
                    }
                }
            }
            logMessage(`${currentPlayer.name} landed on ${newSpaceName.split('\n')[0]}.`);

            // Placeholder for landing actions
            setTimeout(() => {
                // Future: Call function like handleLandingOnSpace(currentPlayer);
                switchTurn();
                rollDiceButton.disabled = false;
            }, 1000);
        }

        /**
         * Switches to the next player's turn.
         */
        function switchTurn() {
            currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
            updateCurrentPlayerDisplay();
            logMessage(`${players[currentPlayerIndex].name}'s (${players[currentPlayerIndex].tokenRepresentation}) turn.`);
            updateAllPlayerInfoDisplays();
        }

        /**
         * Updates the display for whose turn it is.
         */
        function updateCurrentPlayerDisplay() {
            if (players.length > 0) {
                currentPlayerNameDisplay.textContent = `${players[currentPlayerIndex].name} (${players[currentPlayerIndex].tokenRepresentation})`;
            }
        }

        /**
         * Logs a message to the game's message log.
         * @param {string} message - The message to log.
         */
        function logMessage(message) {
            const previousMessage = messageLog.innerHTML;
            messageLog.innerHTML = message + (previousMessage ? '<br>' + previousMessage : '');
            const maxMessages = 10;
            const messages = messageLog.innerHTML.split('<br>');
            if (messages.length > maxMessages) {
                messageLog.innerHTML = messages.slice(0, maxMessages).join('<br>');
            }
        }

        // --- Event Listeners ---
        rollDiceButton.addEventListener('click', handlePlayerTurn);

        // --- Game Initialization ---
        window.onload = () => {
            document.querySelectorAll('.board .space').forEach(spaceEl => {
                if (!spaceEl.querySelector('.content')) {
                    const contentWrapper = document.createElement('div');
                    contentWrapper.classList.add('content');
                    while (spaceEl.firstChild) {
                        contentWrapper.appendChild(spaceEl.firstChild);
                    }
                    spaceEl.appendChild(contentWrapper);
                }
                if (!spaceEl.querySelector('.token-container')) {
                    const tokenContainer = document.createElement('div');
                    tokenContainer.classList.add('token-container');
                    spaceEl.appendChild(tokenContainer);
                }
            });
            initializeGame(2); // Start with 2 players by default
        };

    </script>
</body>
</html>
